<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NFT Kaspa Draw results</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="k-favicon-glow.png" type="image/png">
  <link rel="shortcut icon" href="k-favicon-glow.png" type="image/png">
</head>
<body>
  <nav class="main-nav">
    <ul>
      <li><img src="logonft.png" alt="NFT Kaspa Draw Logo" class="nav-logo"></li>
      <li><a href="index.html">Home</a></li>
      <li><a href="results.html" class="active">Results</a></li>
      <li><a href="how-it-works.html">How it works</a></li>
      <li><a href="https://x.com/nftkaspadraw" target="_blank" class="x-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
        </svg>
        @nftkaspadraw
      </a></li>
    </ul>
  </nav>

  <div class="title-with-icon">
    <img src="k-icon-glow.png" alt="Kaspa Icon" class="title-icon">
    <h1>NFT Kaspa Draw results</h1>
  </div>

  <div class="search-form">
    <select id="nft-collection">
      <option value="AURORA" selected>AURORA</option>
      <option value="NEXT SOON">NEXT SOON</option>
    </select>
    <button onclick="searchNFTCollection()">Show results</button>
  </div>

  <p>Minted NFTs for <span id="current-nft-collection"></span>: <span id="minted-value">-</span></p>
  <p>Total NFTs for <span id="current-nft-collection2"></span>: <span id="max-value">-</span></p>
  <p>Remaining NFTs to mint: <span id="remaining-value">-</span></p>

  <p id="wallet-address-container">Deploy Wallet Address of this draw: <a id="wallet-address-link" href="#" target="_blank"></a></p>

  <div id="last-mint-hash-container" style="display: none;">-</div>
  <p>Last Mint Transaction: <a id="last-mint-transaction-link" href="#" target="_blank">View on Kaspa Explorer</a></p>
  <div id="mint-link-container">
    <p>Last Mint Transaction Hash for winner determination will be available when all NFTs are minted</p>
  </div>
  <div id="hash-number-container">The Winning number will be available when all NFTs are minted</div>
  <div id="winners-info-container">Winners information will be available when all NFTs are minted</div>

  <table id="nft-details" style="display: table !important; visibility: visible !important;">
    <thead>
      <tr>
        <th>Token ID</th>
        <th>Mint Owner</th>
        <th>Status</th>
        <th>Mint Transaction</th>
        <th class="sortable" onclick="sortTableByBlockTime()">Mint Date</th>
        <th>Prize Transaction</th>
      </tr>
    </thead>
    <tbody id="nft-table-body">
      <!-- Data will be populated by JavaScript -->
    </tbody>
  </table>

  <footer class="main-nav footer-nav">
    <div class="footer-content">
      <a href="https://x.com/nftkaspadraw" target="_blank" class="x-link">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
        </svg>
        @nftkaspadraw
      </a>
      <p class="copyright">Â© <span id="current-year"></span> Built on Kaspa</p>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
    // Set current year for copyright
    document.getElementById('current-year').textContent = new Date().getFullYear();

    function updateWinnerDisplay() {
      var mintedText = document.getElementById('minted-value').textContent;
      var maxText = document.getElementById('max-value').textContent;
      var hashContainer = document.getElementById('hash-number-container');
      var winnersContainer = document.getElementById('winners-info-container');
      var mintLinkContainer = document.getElementById('mint-link-container');
      
      if (mintedText === 'Loading...' || mintedText === '-' || mintedText === 'NA' ||
          maxText === 'Loading...' || maxText === '-' || maxText === 'NA') {
        hashContainer.textContent = 'The Winning number will be available when all NFTs are minted';
        if (winnersContainer) winnersContainer.textContent = 'Winners information will be available when all NFTs are minted';
        if (mintLinkContainer) mintLinkContainer.innerHTML = '<p>Last Mint Transaction Hash for winner determination will be available when all NFTs are minted</p>';
        return;
      }
      
      var minted = parseInt(mintedText, 10);
      var max = parseInt(maxText, 10);
      
      if (isNaN(minted) || isNaN(max) || minted < max) {
        hashContainer.textContent = 'The Winning number will be available when all NFTs are minted';
        if (winnersContainer) winnersContainer.textContent = 'Winners information will be available when all NFTs are minted';
        if (mintLinkContainer) mintLinkContainer.innerHTML = '<p>Last Mint Transaction Hash for winner determination will be available when all NFTs are minted</p>';
      }
    }

    const mintedEl = document.getElementById('minted-value');
    const maxEl = document.getElementById('max-value');
    const hashContainer = document.getElementById('hash-number-container');
    const winnersContainer = document.getElementById('winners-info-container');
    const mintLinkContainer = document.getElementById('mint-link-container');
    
    const observer = new MutationObserver(function() {
        updateWinnerDisplay();
        setTimeout(updateWinnerDisplay, 500);
    });
    
    observer.observe(mintedEl, { childList: true, characterData: true, subtree: true });
    observer.observe(maxEl, { childList: true, characterData: true, subtree: true });
    
    const hashObserver = new MutationObserver(function() {
        var mintedText = document.getElementById('minted-value').textContent;
        var maxText = document.getElementById('max-value').textContent;
        var minted = parseInt(mintedText, 10);
        var max = parseInt(maxText, 10);
        if (isNaN(minted) || isNaN(max) || minted < max) {
            if (!hashContainer.textContent.includes('The Winning number will be available when all NFTs are minted')) {
                hashContainer.textContent = 'The Winning number will be available when all NFTs are minted';
            }
            if (winnersContainer && !winnersContainer.textContent.includes('Winners information will be available when all NFTs are minted')) {
                winnersContainer.textContent = 'Winners information will be available when all NFTs are minted';
            }
            if (mintLinkContainer && !mintLinkContainer.innerHTML.includes('Last Mint Transaction Hash for winner determination will be available when all NFTs are minted')) {
                mintLinkContainer.innerHTML = '<p>Last Mint Transaction Hash for winner determination will be available when all NFTs are minted</p>';
            }
        }
    });
    
    hashObserver.observe(hashContainer, { childList: true, characterData: true, subtree: true });
    if (winnersContainer) hashObserver.observe(winnersContainer, { childList: true, characterData: true, subtree: true });
    if (mintLinkContainer) hashObserver.observe(mintLinkContainer, { childList: true, characterData: true, subtree: true });

    updateWinnerDisplay();
  </script>
</body>
</html>
